#!/bin/bash
# Run the jirade Docker container
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Default workspace directory
WORKSPACE_DIR="${JIRADE_WORKSPACE_DIR:-/tmp/jirade-workspace}"
mkdir -p "$WORKSPACE_DIR"

docker run -it --rm \
    -v "$WORKSPACE_DIR:/workspace" \
    -v "$SCRIPT_DIR/configs:/app/configs:ro" \
    -v "$HOME/.jirade:/root/.jirade" \
    -e ANTHROPIC_API_KEY \
    -e JIRADE_JIRA_OAUTH_CLIENT_ID \
    -e JIRADE_JIRA_OAUTH_CLIENT_SECRET \
    -e JIRADE_GITHUB_TOKEN \
    -e JIRADE_DATABRICKS_HOST \
    -e JIRADE_DATABRICKS_TOKEN \
    -e JIRADE_DATABRICKS_HTTP_PATH \
    -e JIRADE_WEBHOOK_SECRET \
    -e JIRADE_LOG_LEVEL \
    -p 8080:8080 \
    jirade:latest "$@"
